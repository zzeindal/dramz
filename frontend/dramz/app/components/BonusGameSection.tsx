'use client'

import { useState, useEffect } from 'react'
import { useRouter } from 'next/navigation'
import { useSelector } from 'react-redux'
import { RootState } from '../state/store'
import { getGameState } from '@/lib/api/game'
import { useTranslation } from '../hooks/useTranslation'

export default function BonusGameSection() {
  const router = useRouter()
  const accessToken = useSelector((state: RootState) => state.auth.accessToken)
  const { t } = useTranslation()
  const [heartsAvailable, setHeartsAvailable] = useState(3)
  const [timeRemaining, setTimeRemaining] = useState(0)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    if (!accessToken) {
      setLoading(false)
      return
    }

    const fetchGameState = async () => {
      try {
        const gameState = await getGameState(accessToken)
        setHeartsAvailable(gameState.lives)
        
        if (gameState.nextPlayAvailableAt) {
          const nextPlayDate = new Date(gameState.nextPlayAvailableAt).getTime()
          const now = Date.now()
          const remaining = Math.max(0, Math.floor((nextPlayDate - now) / 1000))
          setTimeRemaining(remaining)
        } else {
          setTimeRemaining(0)
        }
      } catch (error) {
        console.error('Failed to fetch game state:', error)
      } finally {
        setLoading(false)
      }
    }

    fetchGameState()

    const interval = setInterval(() => {
      setTimeRemaining((prev) => {
        if (prev > 0) {
          if (prev <= 1) {
            if (accessToken) {
              fetchGameState().catch(console.error)
            }
            return 0
          }
          return prev - 1
        } else if (accessToken) {
          fetchGameState().catch(console.error)
        }
        return prev
      })
    }, 1000)

    return () => clearInterval(interval)
  }, [accessToken])

  const formatTime = (seconds: number) => {
    const hours = Math.floor(seconds / 3600)
    const minutes = Math.floor((seconds % 3600) / 60)
    const secs = seconds % 60
    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`
  }

  const gifts = [
    { type: 'crown', value: 20 },
    { type: 'lollipop' },
    { type: 'crown', value: 35 },
    { type: 'mushroom' },
    { type: 'crown', value: 50 },
    { type: 'stick' }
  ]

  const CrownIcon = () => (
    <svg width="46" height="36" viewBox="0 0 46 36" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path fillRule="evenodd" clipRule="evenodd" d="M24.0517 0.842641C22.4229 2.01082 20.0253 4.52947 16.0676 9.22906C14.279 11.3532 12.619 13.2947 12.379 13.5431C12.0012 13.9348 11.2031 13.2749 6.4192 8.61547C1.22981 3.5615 0.863038 3.26737 0.361632 3.75861C-0.212304 4.32092 -0.198422 4.434 1.1065 9.84698C1.75391 12.5322 2.0147 21.6928 1.57699 26.3705C1.27836 29.5617 1.29601 30.1358 1.70439 30.5362C2.40478 31.2221 3.22092 30.581 3.50221 29.1233C3.62993 28.4621 3.82733 25.071 3.94054 21.5875C4.1307 15.728 3.97995 13.0481 3.24487 9.22906C3.04999 8.21536 3.31143 8.41402 7.41476 12.3959C9.82277 14.7326 12.0066 16.6441 12.268 16.6441C12.5297 16.6441 14.2307 14.8132 16.0481 12.5751C17.8658 10.3373 20.6594 7.17416 22.2564 5.54625L25.1598 2.58642L25.1765 6.6029C25.1926 10.4034 25.6454 17.2571 25.9756 18.6956C26.0592 19.0593 26.3275 19.4319 26.5719 19.5236C26.8163 19.6154 30.1168 18.8124 33.9063 17.7388C37.6962 16.6651 40.851 15.8356 40.9172 15.8958C40.9834 15.9557 40.2846 16.8091 39.3644 17.7919C35.6918 21.7154 33.7423 24.7787 29.7106 32.964C29.6835 33.0187 28.7611 32.3504 27.6608 31.4788C24.1213 28.6756 18.5251 26.5308 14.751 26.5308C13.483 26.5308 13.2118 26.6365 13.0286 27.2025C12.7435 28.0824 13.5858 28.6936 15.0834 28.6936C16.8286 28.6936 20.6863 29.8515 23.1302 31.109C24.3462 31.7346 26.2938 33.1268 27.4581 34.2026C29.7191 36.2918 30.4151 36.48 31.0742 35.1796C31.2889 34.756 32.4586 32.3934 33.6733 29.9294C36.163 24.8788 38.1812 22.0787 42.8433 17.2083C44.5793 15.3944 46 13.7081 46 13.4612C46 12.183 45.2826 12.281 36.606 14.7434L28.0642 17.1678L27.8882 16.0561C27.5123 13.6852 27.1023 4.77509 27.2887 3.02792C27.4505 1.51123 27.3855 1.08055 26.9179 0.574469C26.1481 -0.259106 25.5032 -0.198864 24.0517 0.842641Z" fill="url(#paint0_linear_331_1498)"/>
      <path fillRule="evenodd" clipRule="evenodd" d="M24.0517 0.842641C22.4229 2.01082 20.0253 4.52947 16.0676 9.22906C14.279 11.3532 12.619 13.2947 12.379 13.5431C12.0012 13.9348 11.2031 13.2749 6.4192 8.61547C1.22981 3.5615 0.863038 3.26737 0.361632 3.75861C-0.212304 4.32092 -0.198422 4.434 1.1065 9.84698C1.75391 12.5322 2.0147 21.6928 1.57699 26.3705C1.27836 29.5617 1.29601 30.1358 1.70439 30.5362C2.40478 31.2221 3.22092 30.581 3.50221 29.1233C3.62993 28.4621 3.82733 25.071 3.94054 21.5875C4.1307 15.728 3.97995 13.0481 3.24487 9.22906C3.04999 8.21536 3.31143 8.41402 7.41476 12.3959C9.82277 14.7326 12.0066 16.6441 12.268 16.6441C12.5297 16.6441 14.2307 14.8132 16.0481 12.5751C17.8658 10.3373 20.6594 7.17416 22.2564 5.54625L25.1598 2.58642L25.1765 6.6029C25.1926 10.4034 25.6454 17.2571 25.9756 18.6956C26.0592 19.0593 26.3275 19.4319 26.5719 19.5236C26.8163 19.6154 30.1168 18.8124 33.9063 17.7388C37.6962 16.6651 40.851 15.8356 40.9172 15.8958C40.9834 15.9557 40.2846 16.8091 39.3644 17.7919C35.6918 21.7154 33.7423 24.7787 29.7106 32.964C29.6835 33.0187 28.7611 32.3504 27.6608 31.4788C24.1213 28.6756 18.5251 26.5308 14.751 26.5308C13.483 26.5308 13.2118 26.6365 13.0286 27.2025C12.7435 28.0824 13.5858 28.6936 15.0834 28.6936C16.8286 28.6936 20.6863 29.8515 23.1302 31.109C24.3462 31.7346 26.2938 33.1268 27.4581 34.2026C29.7191 36.2918 30.4151 36.48 31.0742 35.1796C31.2889 34.756 32.4586 32.3934 33.6733 29.9294C36.163 24.8788 38.1812 22.0787 42.8433 17.2083C44.5793 15.3944 46 13.7081 46 13.4612C46 12.183 45.2826 12.281 36.606 14.7434L28.0642 17.1678L27.8882 16.0561C27.5123 13.6852 27.1023 4.77509 27.2887 3.02792C27.4505 1.51123 27.3855 1.08055 26.9179 0.574469C26.1481 -0.259106 25.5032 -0.198864 24.0517 0.842641Z" fill="white"/>
      <defs>
        <linearGradient id="paint0_linear_331_1498" x1="23" y1="36" x2="23" y2="0" gradientUnits="userSpaceOnUse">
          <stop stopColor="#B49AFA"/>
          <stop offset="1" stopColor="#704ED7"/>
        </linearGradient>
      </defs>
    </svg>
  )

  const GiftIcon = ({ type, value, imageIndex }: { type: string, value?: number, imageIndex?: number }) => {
    if (type === 'crown' && value) {
      return (
        <div className="flex flex-col items-center justify-center">
          <svg width="20" height="15" viewBox="0 0 20 15" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fillRule="evenodd" clipRule="evenodd" d="M9.28451 0.0427072C9.21657 0.0705591 9.14482 0.109101 9.12504 0.128373C9.10523 0.147672 9.0731 0.163437 9.05361 0.163437C9.01607 0.163437 8.86666 0.322481 8.86666 0.362448C8.86666 0.375419 8.82046 0.465675 8.76399 0.562999C8.70751 0.660353 8.65355 0.770079 8.64407 0.806882C8.63459 0.843685 8.60838 0.888727 8.58582 0.906943C8.56326 0.925188 8.54479 0.959169 8.54479 0.982432C8.54479 1.00572 8.50628 1.10356 8.45923 1.19989C8.41215 1.29621 8.36463 1.4103 8.35363 1.45341C8.34263 1.49651 8.32495 1.5318 8.31433 1.5318C8.30374 1.5318 8.2633 1.61199 8.22444 1.70997C8.18561 1.80798 8.13645 1.90839 8.11524 1.93316C8.094 1.9579 8.07661 1.99291 8.07661 2.01093C8.07661 2.04576 7.98754 2.24503 7.82494 2.57401C7.77025 2.68471 7.72548 2.78577 7.72548 2.79859C7.72548 2.83514 7.54368 3.18564 7.51609 3.20223C7.50251 3.21041 7.49139 3.24075 7.49139 3.26962C7.49139 3.2985 7.43872 3.42245 7.37435 3.54509C7.30997 3.66773 7.2573 3.77831 7.2573 3.79083C7.2573 3.81261 7.20999 3.91438 6.96232 4.42532C6.90152 4.55076 6.82995 4.7047 6.80323 4.76741C6.71574 4.97298 6.57189 5.27476 6.44531 5.51825C6.37693 5.64981 6.32095 5.77347 6.32095 5.79309C6.32095 5.8127 6.29462 5.86136 6.26243 5.90125C6.23024 5.9411 6.20391 5.99275 6.20391 6.01602C6.20391 6.11884 6.0334 6.40506 5.88388 6.55316C5.7812 6.65487 5.43288 6.83849 5.29646 6.86278C5.12379 6.89354 4.88023 6.84838 4.66232 6.74518C4.55262 6.69324 4.45629 6.64381 4.44824 6.63537C4.42893 6.61516 4.22838 6.47299 3.92155 6.26209C3.78475 6.16808 3.64883 6.07164 3.61948 6.04783C3.59016 6.024 3.53422 5.99267 3.49512 5.97819C3.45606 5.96373 3.42411 5.93962 3.42411 5.92459C3.42411 5.9096 3.3945 5.8883 3.35827 5.87727C3.32204 5.86627 3.25106 5.8237 3.20049 5.78271C3.10241 5.70315 3.0285 5.64864 2.92556 5.57988C2.89036 5.55636 2.81513 5.50183 2.75839 5.45872C2.70168 5.41559 2.64304 5.38033 2.62809 5.38033C2.61314 5.38033 2.55239 5.33554 2.49311 5.28081C2.43383 5.22604 2.37118 5.18114 2.35386 5.18103C2.33656 5.18089 2.29147 5.1487 2.25367 5.1095C2.21586 5.07031 2.17557 5.03823 2.16413 5.03823C2.14528 5.03823 1.90678 4.88484 1.69873 4.73891C1.65402 4.70755 1.53346 4.62513 1.43079 4.55574C1.32814 4.48639 1.19014 4.38695 1.1241 4.33481C1.05806 4.28267 0.993685 4.24002 0.981015 4.24002C0.968374 4.24002 0.943005 4.22004 0.924687 4.19564C0.879245 4.13509 0.535135 4.10963 0.390556 4.15612C0.219174 4.21123 0.0381654 4.4087 0.0137617 4.56723C-0.0229024 4.80553 -0.000898167 4.92791 0.262715 5.95048C0.345582 6.2719 0.446327 6.66958 0.48662 6.83421C0.526883 6.99884 0.583913 7.22334 0.61332 7.3331C0.642757 7.44285 0.688872 7.64811 0.715822 7.78922C0.742771 7.93033 0.790086 8.13558 0.820927 8.24534C0.851798 8.35509 0.904117 8.57318 0.937211 8.72997C0.970334 8.88676 1.00954 9.05994 1.02438 9.11482C1.03921 9.1697 1.0597 9.26591 1.06991 9.32863C1.08012 9.39134 1.10069 9.45711 1.11567 9.47476C1.13066 9.4924 1.15854 9.61427 1.17768 9.74558C1.19681 9.87688 1.22306 9.99157 1.236 10.0005C1.24896 10.0094 1.27927 10.1184 1.30338 10.2428C1.32749 10.3672 1.36202 10.5074 1.38011 10.5545C1.39819 10.6015 1.42338 10.7041 1.43611 10.7825C1.46414 10.9552 1.51128 11.1597 1.56864 11.3574C1.59213 11.4384 1.6496 11.6693 1.6963 11.8705C1.74303 12.0718 1.80278 12.3262 1.82906 12.436C1.85536 12.5457 1.89671 12.7317 1.921 12.8493C2.01103 13.2858 2.02771 13.3492 2.06353 13.391C2.08369 13.4145 2.10783 13.4979 2.11716 13.5763C2.16181 13.9513 2.26792 14.159 2.47862 14.284C2.70271 14.4169 2.96316 14.4312 3.38022 14.3335C3.74118 14.2489 4.05082 14.1835 4.25805 14.148C4.52587 14.1021 4.88666 14.0339 5.12125 13.9847C5.20976 13.9661 5.33485 13.9484 5.39923 13.9453C5.4636 13.9422 5.55577 13.9309 5.60406 13.9202C5.85816 13.8639 5.94574 13.85 6.16002 13.8324C6.28876 13.8217 6.44768 13.8019 6.51317 13.7883C6.68911 13.7518 7.82242 13.6543 8.3107 13.6337C9.33782 13.5903 11.6988 13.6446 11.8146 13.7143C11.8282 13.7225 11.9533 13.7319 12.0926 13.7352C12.2318 13.7384 12.4156 13.752 12.5009 13.7654C12.6904 13.795 12.8075 13.8091 13.1753 13.8467C13.3322 13.8627 13.5165 13.8951 13.5849 13.9186C13.6534 13.9422 13.8015 13.9688 13.9142 13.9777C14.0268 13.9867 14.198 14.0065 14.2946 14.0217C14.3911 14.0369 14.5492 14.0611 14.6457 14.0755C14.7989 14.0984 15.1882 14.1754 15.5089 14.2463C15.5652 14.2588 15.6772 14.2823 15.7576 14.2986C15.8381 14.3149 15.9434 14.3472 15.9917 14.3705C16.0633 14.405 16.1281 14.4079 16.3429 14.3862C16.4877 14.3716 16.6106 14.3469 16.616 14.3314C16.6213 14.3159 16.6437 14.3032 16.6658 14.3032C16.7212 14.3032 16.8995 14.1191 16.9654 13.9937C16.9954 13.9366 17.0433 13.7872 17.0718 13.6618C17.1003 13.5363 17.1422 13.3589 17.1648 13.2675C17.1875 13.1761 17.2061 13.0765 17.2061 13.0462C17.2061 13.0159 17.2176 12.9688 17.2317 12.9416C17.2769 12.8544 17.3231 12.6907 17.3231 12.6175C17.3231 12.5399 17.4804 11.9035 17.5118 11.8539C17.5332 11.8202 17.5397 11.7903 17.5706 11.5833C17.582 11.5064 17.6058 11.4102 17.6234 11.3695C17.655 11.2967 17.6855 11.1658 17.7714 10.7342C17.7954 10.6135 17.823 10.5024 17.8326 10.4872C17.8423 10.472 17.8686 10.3719 17.8912 10.2647C17.9329 10.0673 18.1098 9.36178 18.1831 9.10057C18.2051 9.02217 18.2367 8.89389 18.2533 8.81549C18.2699 8.73709 18.3123 8.5575 18.3477 8.41638C18.4234 8.11383 18.4507 7.99142 18.4937 7.76071C18.5113 7.66664 18.5382 7.58539 18.5535 7.58017C18.5688 7.57493 18.5813 7.53003 18.5812 7.48039C18.5811 7.43073 18.6001 7.33238 18.6234 7.26183C18.6466 7.19127 18.7079 6.94753 18.7595 6.72018C18.8111 6.49284 18.8722 6.22985 18.8952 6.13578C18.9183 6.0417 18.9537 5.88748 18.9739 5.79303C18.9941 5.69858 19.0314 5.55106 19.0567 5.46519C19.2053 4.96192 19.238 4.62174 19.1562 4.43099C19.0782 4.24895 18.8377 4.12448 18.5602 4.1224C18.4132 4.12132 18.357 4.13326 18.308 4.17608C18.2732 4.20638 18.1658 4.27831 18.0693 4.33592C17.9727 4.39354 17.8147 4.49807 17.7181 4.56826C17.6216 4.63844 17.5147 4.70778 17.4807 4.72234C17.4467 4.73688 17.4109 4.76901 17.4012 4.79373C17.3914 4.81847 17.3693 4.83868 17.352 4.83868C17.3195 4.83868 16.9398 5.08373 16.9136 5.12162C16.9055 5.13336 16.8363 5.17832 16.7598 5.2216C16.6834 5.26484 16.6208 5.30966 16.6208 5.32123C16.6208 5.34358 16.3485 5.52286 16.3146 5.52286C16.3035 5.52286 16.255 5.56135 16.2067 5.60839C16.1584 5.65542 16.1008 5.69391 16.0787 5.69391C16.0566 5.69391 16.028 5.71081 16.0151 5.73151C15.9865 5.77747 15.6756 5.97899 15.6333 5.97899C15.6166 5.97899 15.5324 6.0429 15.4462 6.12101C15.36 6.19915 15.273 6.26329 15.2529 6.26355C15.2328 6.26383 15.2163 6.27689 15.2163 6.29257C15.2163 6.30825 15.1978 6.32108 15.1752 6.32108C15.1381 6.32108 15.0641 6.37345 14.792 6.59241C14.68 6.68252 14.5062 6.77044 14.3385 6.82178C14.187 6.86817 13.8118 6.87703 13.8118 6.83421C13.8118 6.81853 13.8019 6.80782 13.7898 6.81038C13.7373 6.82156 13.5843 6.76406 13.4899 6.69772C13.2591 6.53545 12.9925 6.16984 12.9925 6.01567C12.9925 5.99261 12.9661 5.9411 12.9339 5.90125C12.9018 5.86136 12.8754 5.80589 12.8754 5.77795C12.8754 5.75001 12.8652 5.7229 12.8526 5.71766C12.8308 5.70859 12.6402 5.31142 12.6292 5.25204C12.6263 5.23636 12.6081 5.19551 12.5887 5.16127C12.5694 5.12701 12.5533 5.08211 12.553 5.0615C12.5527 5.04086 12.5128 4.96697 12.4644 4.89726C12.4159 4.82756 12.3689 4.73776 12.3598 4.69771C12.3508 4.65766 12.3071 4.55432 12.2627 4.46808C12.2183 4.38185 12.1515 4.23432 12.1143 4.14025C12.0772 4.04617 12.0306 3.94996 12.011 3.92644C11.9913 3.90292 11.9655 3.85246 11.9535 3.81429C11.9415 3.77612 11.8807 3.6453 11.8183 3.52357C11.756 3.40184 11.705 3.2938 11.705 3.28345C11.705 3.26714 11.5723 2.99527 11.5041 2.87166C11.4379 2.75193 11.2913 2.44028 11.2368 2.30379C11.1741 2.14648 11.1379 2.06774 10.9081 1.58882C10.8366 1.43986 10.7481 1.24102 10.7115 1.14695C10.6748 1.05287 10.6331 0.956661 10.6189 0.933142C10.5692 0.851154 10.4468 0.583753 10.4468 0.557383C10.4468 0.542759 10.3858 0.451363 10.3112 0.354238C10.1323 0.121188 9.92796 0.0169361 9.62119 0.00225472C9.46406 -0.00524278 9.37551 0.00539073 9.28451 0.0427072Z" fill="white"/>
          </svg>
          <span className="text-white text-xs mt-1" style={{ fontFamily: 'var(--font-days-one), sans-serif' }}>{value}</span>
        </div>
      )
    }
    const imageNumber = imageIndex !== undefined ? ((imageIndex % 3) + 1) : 1
    return (
      <img 
        src={`/game-marquee/${imageNumber}.png`} 
        alt={type}
        className="w-full h-full object-contain block m-0 p-0"
        style={{ display: 'block' }}
      />
    )
  }

  const HeartIcon = ({ enabled }: { enabled: boolean }) => {
    if (enabled) {
      return (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 22C12.1182 22 12.253 21.9691 12.4043 21.9074C12.5557 21.8457 12.6905 21.7785 12.8087 21.7059C14.8913 20.3987 16.6951 19.0279 18.2201 17.5937C19.7451 16.1594 20.923 14.6852 21.7538 13.1711C22.5846 11.6569 23 10.1264 23 8.57952C23 7.61365 22.8431 6.72948 22.5292 5.92701C22.2154 5.12454 21.7797 4.42919 21.222 3.84095C20.6645 3.25272 20.0109 2.79884 19.2613 2.4793C18.5117 2.15977 17.7013 2 16.8299 2C15.7516 2 14.8026 2.27051 13.9829 2.81154C13.1631 3.35258 12.5022 4.07335 12 4.97386C11.5052 4.08061 10.848 3.36166 10.0282 2.81699C9.20847 2.27233 8.2558 2 7.1702 2C6.29877 2 5.4901 2.15977 4.74421 2.4793C3.99832 2.79884 3.34475 3.25272 2.78349 3.84095C2.22223 4.42919 1.78466 5.12454 1.4708 5.92701C1.15693 6.72948 1 7.61365 1 8.57952C1 10.1264 1.41541 11.6569 2.24622 13.1711C3.07704 14.6852 4.25681 16.1594 5.78551 17.5937C7.31421 19.0279 9.11985 20.3987 11.2024 21.7059C11.3206 21.7785 11.4554 21.8457 11.6068 21.9074C11.7582 21.9691 11.8892 22 12 22ZM8.38873 13.1111C8.38873 13.0022 8.43673 12.8933 8.53274 12.7843L13.1077 7.13071C13.2185 6.98547 13.3441 6.91467 13.4845 6.91829C13.6247 6.92193 13.7336 6.97821 13.8111 7.08714C13.8887 7.19607 13.8906 7.34132 13.8167 7.52288L12.3213 11.4989H15.146C15.2494 11.4989 15.3399 11.5334 15.4175 11.6024C15.495 11.6714 15.5338 11.7567 15.5338 11.8584C15.5338 11.9746 15.4821 12.0835 15.3787 12.1852L10.8258 17.8387C10.7076 17.9768 10.5784 18.044 10.4381 18.0403C10.2978 18.0367 10.1888 17.9804 10.1113 17.8714C10.0338 17.7625 10.0282 17.6209 10.0947 17.4467L11.6123 13.4596H8.76537C8.66936 13.4596 8.58259 13.4252 8.50505 13.3562C8.4275 13.2872 8.38873 13.2055 8.38873 13.1111Z" fill="white"/>
        </svg>
      )
    }
    return (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M1 8.57952C1 10.1264 1.41541 11.6569 2.24622 13.1711C3.07704 14.6852 4.25681 16.1594 5.78551 17.5937C7.31421 19.0279 9.11985 20.3987 11.2024 21.7059C11.3206 21.7785 11.4554 21.8457 11.6068 21.9074C11.7582 21.9691 11.8892 22 12 22C12.1182 22 12.253 21.9691 12.4043 21.9074C12.5557 21.8457 12.6905 21.7785 12.8087 21.7059C14.8913 20.3987 16.6951 19.0279 18.2201 17.5937C19.7451 16.1594 20.923 14.6852 21.7538 13.1711C22.5846 11.6569 23 10.1264 23 8.57952C23 7.61365 22.8431 6.72948 22.5292 5.92701C22.2154 5.12454 21.776 4.42919 21.211 3.84095C20.6461 3.25272 19.9814 2.79884 19.2171 2.4793C18.4527 2.15977 17.62 2 16.719 2C15.6925 2 14.775 2.2215 13.9663 2.66449C13.1576 3.10748 12.5022 3.69572 12 4.4292C11.5052 3.69572 10.8516 3.10748 10.0393 2.66449C9.22693 2.2215 8.3075 2 7.28098 2C6.38739 2 5.55842 2.15977 4.79407 2.4793C4.02971 2.79884 3.36321 3.25272 2.79456 3.84095C2.22592 4.42919 1.78466 5.12454 1.4708 5.92701C1.15693 6.72948 1 7.61365 1 8.57952ZM2.78349 8.57952C2.78349 7.61365 2.97735 6.76942 3.36506 6.04684C3.75278 5.32425 4.2845 4.76143 4.96023 4.35839C5.63596 3.95534 6.40216 3.75381 7.25882 3.75381C7.95302 3.75381 8.5549 3.87546 9.06447 4.11874C9.57403 4.36202 10.0061 4.66522 10.3605 5.02832C10.715 5.39143 11.0104 5.75454 11.2467 6.11765C11.4018 6.33551 11.5329 6.48257 11.64 6.55882C11.7471 6.63508 11.8671 6.6732 12 6.6732C12.133 6.6732 12.2511 6.63326 12.3545 6.55337C12.4579 6.47349 12.5908 6.32825 12.7533 6.11765C13.0044 5.7618 13.309 5.4005 13.6672 5.03377C14.0253 4.66703 14.4537 4.36202 14.9522 4.11874C15.4507 3.87546 16.047 3.75381 16.7413 3.75381C17.5979 3.75381 18.3641 3.95534 19.0398 4.35839C19.7155 4.76143 20.2473 5.32425 20.635 6.04684C21.0227 6.76942 21.2166 7.61365 21.2166 8.57952C21.2166 9.58896 20.9692 10.6111 20.4744 11.646C19.9796 12.6808 19.3094 13.6958 18.4638 14.6907C17.6182 15.6855 16.6581 16.635 15.5836 17.5392C14.509 18.4434 13.3921 19.2731 12.2326 20.0283C12.1071 20.1155 12.0296 20.159 12 20.159C11.9705 20.159 11.8966 20.1155 11.7785 20.0283C10.619 19.2731 9.50203 18.4434 8.4275 17.5392C7.35298 16.635 6.39108 15.6855 5.5418 14.6907C4.69252 13.6958 4.02048 12.6808 3.52568 11.646C3.03089 10.6111 2.78349 9.58896 2.78349 8.57952ZM8.49951 13.0676C8.49951 13.1619 8.53643 13.2418 8.61028 13.3072C8.68413 13.3725 8.76906 13.4052 8.86506 13.4052H11.6234L10.1501 17.2723C10.0836 17.4466 10.0891 17.5864 10.1667 17.6917C10.2442 17.797 10.3495 17.8515 10.4824 17.8551C10.6153 17.8588 10.7409 17.7916 10.859 17.6536L15.279 12.1743C15.375 12.0726 15.4229 11.9673 15.4229 11.8584C15.4229 11.7567 15.386 11.6732 15.3122 11.6078C15.2383 11.5425 15.1497 11.5098 15.0463 11.5098H12.3102L13.7613 7.65359C13.8278 7.4793 13.8241 7.33951 13.7502 7.23421C13.6764 7.1289 13.573 7.07443 13.4401 7.0708C13.3072 7.06717 13.1853 7.13435 13.0745 7.27233L8.63244 12.7517C8.54382 12.8678 8.49951 12.9731 8.49951 13.0676Z" fill="white" fillOpacity="0.6"/>
      </svg>
    )
  }

  const isPlayAvailable = heartsAvailable > 0 && timeRemaining === 0 && !loading

  return (
    <section className="px-4 mt-8 mb-8">
      <div
        className="rounded-2xl p-3 relative overflow-hidden"
        style={{
          background: 'linear-gradient(180deg, #8F37FF 0%, #AC6BFF 100%)',
          boxShadow: 'inset 0 0 20px rgba(255, 255, 255, 0.4), 0 4px 20px rgba(170, 102, 255, 0.5)'
        }}
      >
        <div className="flex items-center justify-between mb-2">
          <h3 className="text-xl font-bold text-white">{t('game.bonusGame')}</h3>
          <CrownIcon />
        </div>
        
        <p className="text-white/90 text-sm mb-2">{t('game.bonusGameDescription')}</p>
        
        <div className="overflow-hidden mb-2 relative" style={{ WebkitMaskImage: 'linear-gradient(to right, transparent, black 10%, black 90%, transparent)', maskImage: 'linear-gradient(to right, transparent, black 10%, black 90%, transparent)' }}>
          <div
            className="flex gap-4"
            style={{
              animation: 'marquee 20s linear infinite',
              width: 'fit-content'
            }}
          >
            {[...gifts, ...gifts].map((gift, idx) => {
              let nonCrownIndex = 0
              for (let i = 0; i < idx; i++) {
                const currentGift = [...gifts, ...gifts][i]
                if (currentGift.type !== 'crown') {
                  nonCrownIndex++
                }
              }
              const imageIndex = gift.type !== 'crown' ? nonCrownIndex : undefined
              return (
                <div
                  key={idx}
                  className={`w-[52px] h-[52px] rounded-lg m-0 p-0 ${gift.type === 'crown' ? 'flex items-center justify-center' : 'overflow-hidden'}`}
                  style={{
                    background: gift.type === 'crown' ? '#00000066' : ''
                  }}
                >
                  <GiftIcon type={gift.type} value={gift.value} imageIndex={imageIndex} />
                </div>
              )
            })}
          </div>
        </div>

        <div className="flex items-center justify-between">
          <div className="flex flex-col">
            <div className="flex gap-2 mb-2">
              {[0, 1, 2].map((idx) => (
                <HeartIcon key={idx} enabled={idx < heartsAvailable} />
              ))}
            </div>
            <span className="text-white text-xs">
              {timeRemaining > 0 ? formatTime(timeRemaining) : heartsAvailable === 3 ? t('game.livesRestored') : ''}
            </span>
          </div>
          
          <button
            className={`px-6 py-2 rounded-[8px] font-medium text-sm transition-opacity ${
              isPlayAvailable
                ? 'bg-white text-[#8F37FF] cursor-pointer'
                : 'bg-white/50 text-[#8F37FF]/50'
            }`}
            disabled={!isPlayAvailable}
            // onClick={() => router.push('/game')}
          >
            {t('game.play')}
          </button>
        </div>

        <style jsx>{`
          @keyframes marquee {
            0% {
              transform: translateX(0);
            }
            100% {
              transform: translateX(-50%);
            }
          }
        `}</style>
      </div>
    </section>
  )
}

